

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Importance Sampling Examples &mdash; QMCPy 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Sampling from Known and Unknown Measures" href="sampling_measures.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> QMCPy
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">About Our QMC Software Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">QMCPy Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../demos.html">Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">QMCPy Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmcpy_intro.html">Welcome to QMCPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration_examples.html">Integration Examples using QMCPy package</a></li>
<li class="toctree-l2"><a class="reference internal" href="lebesgue_integration.html">QMCPy for Lebesgue Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample_scatter_plots.html">Scatter Plots of Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="MC_vs_QMC.html">A Monte Carlo vs Quasi-Monte Carlo Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="quasirandom_generators.html">Quasi-Random Sequence Generator Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampling_measures.html">Sampling from Known and Unknown Measures</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Importance Sampling Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#game-example">Game Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vanilla-monte-carlo">Vanilla Monte Carlo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monte-carlo-with-importance-sampling">Monte Carlo with Importance Sampling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#asian-call-option-example">Asian Call Option Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Vanilla Monte Carlo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Monte Carlo with Importance Sampling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#importance-sampling-mc-vs-qmc">Importance Sampling MC vs QMC</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QMCPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../demos.html">Demos</a> &raquo;</li>
        
      <li>Importance Sampling Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
            
  <div class="section" id="importance-sampling-examples">
<h1>Importance Sampling Examples<a class="headerlink" href="#importance-sampling-examples" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qmcpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="game-example">
<h2>Game Example<a class="headerlink" href="#game-example" title="Permalink to this headline">¶</a></h2>
<p>Consider a game where
<img class="math" src="../_images/math/7cbc37d64c9c38b7db7b5440d85ffe3b9210d975.png" alt="X_1, X_2 \overset{\textrm{IID}}{\sim} \mathcal{U}(0,1)"/> are drawn
with a payoff of</p>
<div class="math">
<p><img src="../_images/math/ee5b2e64b7a7cfff6f036574bc08b085ba50c450.png" alt="Y = \text{payoff}(X_1,X_2) = \begin{cases} \$10, &amp; 1.7 \le X_1 + X_2 \le 2, \\ 0, &amp; 0 \le X_1 + X_2 &lt; 1.7, \end{cases}

What is the expected payoff of this game?"/></p>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">payoff</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.7</span><span class="p">)</span>
<span class="n">abs_tol</span> <span class="o">=</span> <span class="mf">1e-3</span>
</pre></div>
</div>
<div class="section" id="vanilla-monte-carlo">
<h3>Vanilla Monte Carlo<a class="headerlink" href="#vanilla-monte-carlo" title="Permalink to this headline">¶</a></h3>
<p>With ordinary Monte Carlo we do the following:</p>
<div class="math">
<p><img src="../_images/math/adc2df06b15cf8ac84142b29e01db67710c12ff3.png" alt="\mu = \mathbb{E}(Y) = \int_{[0,1]^2} \text{payoff}(x_1,x_2) \,
\mathrm{d} x_1 \mathrm{d}x_2"/></p>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">measure</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
<span class="n">integral</span> <span class="o">=</span> <span class="n">QuickConstruct</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span><span class="n">payoff</span><span class="p">)</span>
<span class="n">solution1</span><span class="p">,</span><span class="n">data1</span> <span class="o">=</span> <span class="n">CubLattice_g</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">)</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
<span class="n">data1</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Solution</span><span class="p">:</span> <span class="mf">0.4500</span>
<span class="n">QuickConstruct</span> <span class="p">(</span><span class="n">Integrand</span> <span class="n">Object</span><span class="p">)</span>
<span class="n">Lattice</span> <span class="p">(</span><span class="n">DiscreteDistribution</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">dimension</span>       <span class="mi">2</span>
    <span class="n">scramble</span>        <span class="mi">1</span>
    <span class="n">seed</span>            <span class="kc">None</span>
    <span class="n">backend</span>         <span class="n">gail</span>
    <span class="n">mimics</span>          <span class="n">StdUniform</span>
<span class="n">Uniform</span> <span class="p">(</span><span class="n">TrueMeasure</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">distrib_name</span>    <span class="n">Lattice</span>
    <span class="n">lower_bound</span>     <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">upper_bound</span>     <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">CubLattice_g</span> <span class="p">(</span><span class="n">StoppingCriterion</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">abs_tol</span>         <span class="mf">0.001</span>
    <span class="n">rel_tol</span>         <span class="mi">0</span>
    <span class="n">n_init</span>          <span class="mi">1024</span>
    <span class="n">n_max</span>           <span class="mi">34359738368</span>
<span class="n">CubatureData</span> <span class="p">(</span><span class="n">AccumulateData</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">n_total</span>         <span class="mi">65536</span>
    <span class="n">solution</span>        <span class="mf">0.450</span>
    <span class="n">r_lag</span>           <span class="mi">4</span>
    <span class="n">time_integrate</span>  <span class="mf">0.070</span>
</pre></div>
</div>
</div>
<div class="section" id="monte-carlo-with-importance-sampling">
<h3>Monte Carlo with Importance Sampling<a class="headerlink" href="#monte-carlo-with-importance-sampling" title="Permalink to this headline">¶</a></h3>
<p>We may add the importance sampling to increase the number of samples
with positive payoffs. Let</p>
<div class="math">
<p><img src="../_images/math/b2f2f8f1d9606625e06f7946de4351e83a137aa9.png" alt="\boldsymbol{Z} = (X_1^{1/(p+1)}, X_2^{1/(p+1)}), \qquad \boldsymbol{X} \sim \mathcal{U}(0,1)^2"/></p>
</div><p>This means that <img class="math" src="../_images/math/39581aceb26759cb97ce5767a308086e59aba10f.png" alt="Z_1"/> and <img class="math" src="../_images/math/46011fd9190f47f8fb08bb484d5ceac65ef9a9f2.png" alt="Z_2"/> are IID with common CDF
<img class="math" src="../_images/math/b32e3d5350c4c7d2e4aab2cb5fcbe9ebe512bf21.png" alt="F(z) =z^{p+1}"/> and common PDF
<img class="math" src="../_images/math/c1df87693f06e3c6d84b3ff64f76999898460f0b.png" alt="\varrho(z) = (p+1)z^{p}"/>.Thus,</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">\begin{align}
\mu = \mathbb{E}(Y) &amp;= \int_{[0,1]^2} \frac{\text{payoff}(z_1,z_2)}{(p+1)^2(z_1z_2)^{p}} \, \varrho(z_1)
\varrho(z_2) \, \mathrm{d} z_1 \mathrm{d}z_2 \\
&amp;= \int_{[0,1]^2}
\frac{\text{payoff}(x_1^{1/(p+1)},x_2^{1/(p+1)})}{(p+1)^2(x_1x_2)^{p/(p+1)}}
\, \mathrm{d} x_1 \mathrm{d}x_2
\end{align}</span>)</p>
<p>latex exited with error
[stdout]
This is pdfTeX, Version 3.14159265-2.6-1.40.18 (TeX Live 2017/Debian) (preloaded format=latex)
 restricted \write18 enabled.
entering extended mode
(./math.tex
LaTeX2e &lt;2017-04-15&gt;
Babel &lt;3.18&gt; and hyphenation patterns for 84 language(s) loaded.
(/usr/share/texlive/texmf-dist/tex/latex/base/article.cls
Document Class: article 2014/09/29 v1.4h Standard LaTeX document class
(/usr/share/texlive/texmf-dist/tex/latex/base/size12.clo))
(/usr/share/texlive/texmf-dist/tex/latex/base/inputenc.sty
(/usr/share/texlive/texmf-dist/tex/latex/base/utf8.def
(/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.dfu)
(/usr/share/texlive/texmf-dist/tex/latex/base/ot1enc.dfu)
(/usr/share/texlive/texmf-dist/tex/latex/base/omsenc.dfu)))
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsmath.sty
For additional information on amsmath, use the `?' option.
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amstext.sty
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsgen.sty))
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsbsy.sty)
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsopn.sty))
(/usr/share/texlive/texmf-dist/tex/latex/amscls/amsthm.sty)
(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amssymb.sty
(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amsfonts.sty))
(/usr/share/texlive/texmf-dist/tex/latex/anyfontsize/anyfontsize.sty)
(/usr/share/texlive/texmf-dist/tex/latex/tools/bm.sty) (./math.aux)
(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/umsa.fd)
(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/umsb.fd)
! Misplaced \omit.
\math&#64;cr&#64;&#64;&#64; ...&#64; \&#64;ne \add&#64;amps \maxfields&#64; \omit 
                                                  \kern -\alignsep&#64; \iftag&#64; ...
l.20 \end{align}\end{split}
                           
! Misplaced \omit.
\math&#64;cr&#64;&#64;&#64; ...&#64; \&#64;ne \add&#64;amps \maxfields&#64; \omit 
                                                  \kern -\alignsep&#64; \iftag&#64; ...
l.20 \end{align}\end{split}
                           
[1] (./math.aux) )
(see the transcript file for additional information)
Output written on math.dvi (1 page, 1104 bytes).
Transcript written on math.log.
</p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">distribution</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">measure</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
<span class="n">integral</span> <span class="o">=</span> <span class="n">QuickConstruct</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">payoff</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="o">/</span> <span class="p">((</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
<span class="n">solution2</span><span class="p">,</span><span class="n">data2</span> <span class="o">=</span> <span class="n">CubLattice_g</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">)</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
<span class="n">data2</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Solution</span><span class="p">:</span> <span class="mf">0.4501</span>
<span class="n">QuickConstruct</span> <span class="p">(</span><span class="n">Integrand</span> <span class="n">Object</span><span class="p">)</span>
<span class="n">Lattice</span> <span class="p">(</span><span class="n">DiscreteDistribution</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">dimension</span>       <span class="mi">2</span>
    <span class="n">scramble</span>        <span class="mi">1</span>
    <span class="n">seed</span>            <span class="kc">None</span>
    <span class="n">backend</span>         <span class="n">gail</span>
    <span class="n">mimics</span>          <span class="n">StdUniform</span>
<span class="n">Uniform</span> <span class="p">(</span><span class="n">TrueMeasure</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">distrib_name</span>    <span class="n">Lattice</span>
    <span class="n">lower_bound</span>     <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">upper_bound</span>     <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">CubLattice_g</span> <span class="p">(</span><span class="n">StoppingCriterion</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">abs_tol</span>         <span class="mf">0.001</span>
    <span class="n">rel_tol</span>         <span class="mi">0</span>
    <span class="n">n_init</span>          <span class="mi">1024</span>
    <span class="n">n_max</span>           <span class="mi">34359738368</span>
<span class="n">CubatureData</span> <span class="p">(</span><span class="n">AccumulateData</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">n_total</span>         <span class="mi">16384</span>
    <span class="n">solution</span>        <span class="mf">0.450</span>
    <span class="n">r_lag</span>           <span class="mi">4</span>
    <span class="n">time_integrate</span>  <span class="mf">0.036</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Imporance Sampling takes </span><span class="si">%.3f</span><span class="s1"> the time and </span><span class="si">%.3f</span><span class="s1"> the samples&#39;</span><span class="o">%</span>\
     <span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">time_integrate</span><span class="o">/</span><span class="n">data1</span><span class="o">.</span><span class="n">time_integrate</span><span class="p">,</span><span class="n">data2</span><span class="o">.</span><span class="n">n_total</span><span class="o">/</span><span class="n">data1</span><span class="o">.</span><span class="n">n_total</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Imporance</span> <span class="n">Sampling</span> <span class="n">takes</span> <span class="mf">0.507</span> <span class="n">the</span> <span class="n">time</span> <span class="ow">and</span> <span class="mf">0.250</span> <span class="n">the</span> <span class="n">samples</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="asian-call-option-example">
<h2>Asian Call Option Example<a class="headerlink" href="#asian-call-option-example" title="Permalink to this headline">¶</a></h2>
<p>The stock price must raise significantly for the payoff to be positive.
So we will give a upward drift to the Brownian motion that defines the
stock price path. We can think of the option price as the
multidimensional integral</p>
<div class="math">
<p><img src="../_images/math/8c3ec0f4f51d93f6048cefc5928785f5c31703a2.png" alt="\mu = \mathbb{E}[f(\boldsymbol{X})] = \int_{\mathbb{R}^d}
f(\boldsymbol{x})
\frac{\exp\bigl(-\frac{1}{2} \boldsymbol{x}^T\mathsf{\Sigma}^{-1}
\boldsymbol{x}\bigr)}
{\sqrt{(2 \pi)^{d} \det(\mathsf{\Sigma})}} \, \mathrm{d} \boldsymbol{x}"/></p>
</div><p>where</p>
<p>We will replace <img class="math" src="../_images/math/5cbf91ac89c6a94f352a437d87b12e30be9ccd1f.png" alt="\boldsymbol{X}"/> by</p>
<div class="math">
<p><img src="../_images/math/0f2106d849805c03e1598c178ec93b4c56629888.png" alt="\boldsymbol{Z} \sim \mathcal{N}(\boldsymbol{a}, \mathsf{\Sigma}),
\qquad \boldsymbol{a} = (aT/d)(1, \ldots, d)"/></p>
</div><p>where a positive <img class="math" src="../_images/math/b3e65e3b6408fcfa00452530b73f55d1755f9965.png" alt="a"/> will create more positive payoffs. This
corresponds to giving our Brownian motion a drift. To do this we
re-write the integral as</p>
<p>Finally note that</p>
<div class="math">
<p><img src="../_images/math/770f918b1ad3b51f826bc5da626f5fff48ca8971.png" alt="\mathsf{\Sigma}^{-1}\boldsymbol{a} = \begin{pmatrix} 0 \\ 0 \\ \vdots
\\ 0 \\ a \end{pmatrix}, \qquad f_{\mathrm{new}}(\boldsymbol{z}) =
f(\boldsymbol{z}) \exp\bigl((aT/2 - z_d)a \bigr)"/></p>
</div><p>This drift in the Brownian motion may be implemented by changing the
<code class="docutils literal notranslate"><span class="pre">mean_shift_is</span></code> input to the <code class="docutils literal notranslate"><span class="pre">BrownianMotion</span></code> object.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abs_tol</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="n">dimension</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">def</span> <span class="nf">plt_bm_is</span><span class="p">(</span><span class="n">measure</span><span class="p">):</span>
    <span class="n">n_plt</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">gen_mimic_samples</span><span class="p">(</span><span class="n">n_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_max</span><span class="o">=</span><span class="n">n_plt</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_plt</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">measure</span><span class="o">.</span><span class="n">time_vector</span><span class="p">,</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;option price&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Brownian Motion with Mean Shift </span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">measure</span>.mean_shift_is)
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="id1">
<h3>Vanilla Monte Carlo<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution</span> <span class="o">=</span> <span class="n">Sobol</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
<span class="n">measure</span> <span class="o">=</span> <span class="n">BrownianMotion</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
<span class="n">integrand</span> <span class="o">=</span> <span class="n">AsianCall</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
<span class="n">solution1</span><span class="p">,</span><span class="n">data1</span> <span class="o">=</span> <span class="n">CubSobol_g</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">)</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
<span class="n">data1</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Solution</span><span class="p">:</span> <span class="mf">1.7816</span>
<span class="n">AsianCall</span> <span class="p">(</span><span class="n">Integrand</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">volatility</span>      <span class="mf">0.500</span>
    <span class="n">start_price</span>     <span class="mi">30</span>
    <span class="n">strike_price</span>    <span class="mi">35</span>
    <span class="n">interest_rate</span>   <span class="mi">0</span>
    <span class="n">mean_type</span>       <span class="n">arithmetic</span>
    <span class="n">dimensions</span>      <span class="mi">32</span>
    <span class="n">dim_fracs</span>       <span class="mi">0</span>
<span class="n">Sobol</span> <span class="p">(</span><span class="n">DiscreteDistribution</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">dimension</span>       <span class="mi">32</span>
    <span class="n">scramble</span>        <span class="mi">1</span>
    <span class="n">seed</span>            <span class="mi">839435032</span>
    <span class="n">backend</span>         <span class="n">qrng</span>
    <span class="n">mimics</span>          <span class="n">StdUniform</span>
<span class="n">BrownianMotion</span> <span class="p">(</span><span class="n">TrueMeasure</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">distrib_name</span>    <span class="n">Sobol</span>
    <span class="n">time_vector</span>     <span class="p">[</span> <span class="mf">0.031</span>  <span class="mf">0.062</span>  <span class="mf">0.094</span> <span class="o">...</span>  <span class="mf">0.938</span>  <span class="mf">0.969</span>  <span class="mf">1.000</span><span class="p">]</span>
<span class="n">CubSobol_g</span> <span class="p">(</span><span class="n">StoppingCriterion</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">abs_tol</span>         <span class="mf">0.010</span>
    <span class="n">rel_tol</span>         <span class="mi">0</span>
    <span class="n">n_init</span>          <span class="mi">1024</span>
    <span class="n">n_max</span>           <span class="mi">34359738368</span>
<span class="n">CubatureData</span> <span class="p">(</span><span class="n">AccumulateData</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">n_total</span>         <span class="mi">16384</span>
    <span class="n">solution</span>        <span class="mf">1.782</span>
    <span class="n">r_lag</span>           <span class="mi">4</span>
    <span class="n">time_integrate</span>  <span class="mf">0.176</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt_bm_is</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/importance_sampling_13_0.png" src="../_images/importance_sampling_13_0.png" />
</div>
<div class="section" id="id2">
<h3>Monte Carlo with Importance Sampling<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_shift_is</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">distribution</span> <span class="o">=</span> <span class="n">Sobol</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
<span class="n">measure</span> <span class="o">=</span> <span class="n">BrownianMotion</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span><span class="n">mean_shift_is</span><span class="p">)</span>
<span class="n">integrand</span> <span class="o">=</span> <span class="n">AsianCall</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
<span class="n">solution2</span><span class="p">,</span><span class="n">data2</span> <span class="o">=</span> <span class="n">CubSobol_g</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">)</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
<span class="n">data2</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Solution</span><span class="p">:</span> <span class="mf">1.8039</span>
<span class="n">AsianCall</span> <span class="p">(</span><span class="n">Integrand</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">volatility</span>      <span class="mf">0.500</span>
    <span class="n">start_price</span>     <span class="mi">30</span>
    <span class="n">strike_price</span>    <span class="mi">35</span>
    <span class="n">interest_rate</span>   <span class="mi">0</span>
    <span class="n">mean_type</span>       <span class="n">arithmetic</span>
    <span class="n">dimensions</span>      <span class="mi">32</span>
    <span class="n">dim_fracs</span>       <span class="mi">0</span>
<span class="n">Sobol</span> <span class="p">(</span><span class="n">DiscreteDistribution</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">dimension</span>       <span class="mi">32</span>
    <span class="n">scramble</span>        <span class="mi">1</span>
    <span class="n">seed</span>            <span class="mi">2088013629</span>
    <span class="n">backend</span>         <span class="n">qrng</span>
    <span class="n">mimics</span>          <span class="n">StdUniform</span>
<span class="n">BrownianMotion</span> <span class="p">(</span><span class="n">TrueMeasure</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">distrib_name</span>    <span class="n">Sobol</span>
    <span class="n">time_vector</span>     <span class="p">[</span> <span class="mf">0.031</span>  <span class="mf">0.062</span>  <span class="mf">0.094</span> <span class="o">...</span>  <span class="mf">0.938</span>  <span class="mf">0.969</span>  <span class="mf">1.000</span><span class="p">]</span>
<span class="n">CubSobol_g</span> <span class="p">(</span><span class="n">StoppingCriterion</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">abs_tol</span>         <span class="mf">0.010</span>
    <span class="n">rel_tol</span>         <span class="mi">0</span>
    <span class="n">n_init</span>          <span class="mi">1024</span>
    <span class="n">n_max</span>           <span class="mi">34359738368</span>
<span class="n">CubatureData</span> <span class="p">(</span><span class="n">AccumulateData</span> <span class="n">Object</span><span class="p">)</span>
    <span class="n">n_total</span>         <span class="mi">4096</span>
    <span class="n">solution</span>        <span class="mf">1.804</span>
    <span class="n">r_lag</span>           <span class="mi">4</span>
    <span class="n">time_integrate</span>  <span class="mf">0.033</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt_bm_is</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/importance_sampling_16_0.png" src="../_images/importance_sampling_16_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Imporance Sampling takes </span><span class="si">%.3f</span><span class="s1"> the time and </span><span class="si">%.3f</span><span class="s1"> the samples&#39;</span><span class="o">%</span>\
     <span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">time_integrate</span><span class="o">/</span><span class="n">data1</span><span class="o">.</span><span class="n">time_integrate</span><span class="p">,</span><span class="n">data2</span><span class="o">.</span><span class="n">n_total</span><span class="o">/</span><span class="n">data1</span><span class="o">.</span><span class="n">n_total</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Imporance</span> <span class="n">Sampling</span> <span class="n">takes</span> <span class="mf">0.189</span> <span class="n">the</span> <span class="n">time</span> <span class="ow">and</span> <span class="mf">0.250</span> <span class="n">the</span> <span class="n">samples</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="importance-sampling-mc-vs-qmc">
<h2>Importance Sampling MC vs QMC<a class="headerlink" href="#importance-sampling-mc-vs-qmc" title="Permalink to this headline">¶</a></h2>
<p><strong>Test Parameters</strong></p>
<ul class="simple">
<li><p>dimension = 16</p></li>
<li><p>abs_tol = .025</p></li>
<li><p>trials = 3</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../outputs/mc_vs_qmc/importance_sampling_compare_mean_shifts.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Stopping Criterion&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Distribution&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MC/QMC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Stopping Criterion&#39;</span><span class="p">,</span><span class="s1">&#39;Distribution&#39;</span><span class="p">,</span><span class="s1">&#39;MC/QMC&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">problems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CLT IIDStdUniform (MC)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MeanMC_g IIDStdGaussian (MC)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CLTRep Sobol (QMC)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CubLattice_g Lattice (QMC)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CubSobol_g Sobol (QMC)&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Problem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">problems</span><span class="p">)]</span>
<span class="n">mean_shifts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">df_samples</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Problem&#39;</span><span class="p">])[</span><span class="s1">&#39;n_samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">df_times</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Problem&#39;</span><span class="p">])[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Problem&#39;</span><span class="p">)</span>
<span class="c1"># Note: mean_shift==0 --&gt; NOT using importance sampling</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_shift</th>
      <th>solution</th>
      <th>n_samples</th>
      <th>time</th>
    </tr>
    <tr>
      <th>Problem</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CLT IIDStdUniform (MC)</th>
      <td>0.00e+00</td>
      <td>1.78e+00</td>
      <td>3.24e+05</td>
      <td>6.57e-01</td>
    </tr>
    <tr>
      <th>CLT IIDStdUniform (MC)</th>
      <td>1.00e+00</td>
      <td>1.79e+00</td>
      <td>8.22e+04</td>
      <td>1.70e-01</td>
    </tr>
    <tr>
      <th>MeanMC_g IIDStdGaussian (MC)</th>
      <td>0.00e+00</td>
      <td>1.79e+00</td>
      <td>4.82e+05</td>
      <td>3.36e-01</td>
    </tr>
    <tr>
      <th>MeanMC_g IIDStdGaussian (MC)</th>
      <td>1.00e+00</td>
      <td>1.77e+00</td>
      <td>1.27e+05</td>
      <td>1.02e-01</td>
    </tr>
    <tr>
      <th>CLTRep Sobol (QMC)</th>
      <td>0.00e+00</td>
      <td>1.78e+00</td>
      <td>1.64e+04</td>
      <td>5.69e-02</td>
    </tr>
    <tr>
      <th>CLTRep Sobol (QMC)</th>
      <td>1.00e+00</td>
      <td>1.79e+00</td>
      <td>1.64e+04</td>
      <td>4.91e-02</td>
    </tr>
    <tr>
      <th>CubLattice_g Lattice (QMC)</th>
      <td>0.00e+00</td>
      <td>1.75e+00</td>
      <td>4.10e+03</td>
      <td>1.96e-02</td>
    </tr>
    <tr>
      <th>CubLattice_g Lattice (QMC)</th>
      <td>1.00e+00</td>
      <td>1.81e+00</td>
      <td>1.02e+03</td>
      <td>5.88e-03</td>
    </tr>
    <tr>
      <th>CubSobol_g Sobol (QMC)</th>
      <td>0.00e+00</td>
      <td>1.79e+00</td>
      <td>4.10e+03</td>
      <td>1.62e-02</td>
    </tr>
    <tr>
      <th>CubSobol_g Sobol (QMC)</th>
      <td>1.00e+00</td>
      <td>1.81e+00</td>
      <td>1.02e+03</td>
      <td>5.06e-03</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">problems</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="o">.</span><span class="mi">35</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="n">width</span><span class="p">,</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">==</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;n_samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">width</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">==</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;n_samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">width</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="n">width</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">==</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">width</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">mean_shift</span><span class="o">==</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">width</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Importance Sampling Comparison by Stopping Criterion on Asian Call Option&#39;</span><span class="p">)</span>
<span class="n">xlabs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Samples&#39;</span><span class="p">,</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Vanilla Monte Carlo&#39;</span><span class="p">,</span><span class="s1">&#39;Importance Sampling</span><span class="se">\n</span><span class="s1">Mean Shift=1&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">problems</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../outputs/mc_vs_qmc/vary_mean_shift_bar.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/importance_sampling_20_0.png" src="../_images/importance_sampling_20_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">df_samples</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_shifts</span><span class="p">,</span><span class="n">log</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">n</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Problem&#39;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_times</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_shifts</span><span class="p">,</span><span class="n">log</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">time</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Problem&#39;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">problems</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(samples)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(time)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mean shift&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comparing Mean Shift Across Problems&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../outputs/mc_vs_qmc/vary_mean_shift.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/importance_sampling_21_0.png" src="../_images/importance_sampling_21_0.png" />
</div>
</div>


           </div>
           
          </div>
    <a href="https://github.com/QMCSoftware/QMCSoftware">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
    </a>

          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="sampling_measures.html" class="btn btn-neutral float-left" title="Sampling from Known and Unknown Measures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Illinois Institute of Technology

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>