# cSpell:words Booktests ipynb booktests booktest gpytorch botorch umbridge
name: Booktests

on:
  push:
    paths:
      - 'demos/**/*.ipynb'
      - '.github/workflows/booktests.yml'
  pull_request:
    paths:
      - 'demos/**/*.ipynb'
      - '.github/workflows/booktests.yml'

jobs:
  booktests:
    timeout-minutes: 120
    name: Notebook Tests
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
    steps:
      - uses: actions/checkout@v4
      - name: Install LaTeX
        run: |
          if [[ "$RUNNER_OS" == "Linux" ]]; then
            sudo apt-get update
            sudo apt-get install -y texlive-full
          elif [[ "$RUNNER_OS" == "macOS" ]]; then
            brew install --cask mactex
          fi
      - uses: conda-incubator/setup-miniconda@v3
        with:
          miniconda-version: "latest"
          auto-activate-base: true
      - name: Install base dependencies
        run: pip install -e ".[test]"
      - name: Install Jupyter kernel
        run: python -m ipykernel install --user --name=qmcpy
      - name: Run notebook tests
        shell: bash -l {0}
        run: make booktests_parallel_no_docker TESTS="tb_Argonne_2023_Talk_Figures tb_Purdue_Talk_Figures" UARGS="-v --failfast"
